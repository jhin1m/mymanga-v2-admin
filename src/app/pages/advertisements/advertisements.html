<!-- Search/Filter Section -->
<nz-card nzTitle="Quản lý Quảng cáo" [nzExtra]="searchExtra">
  <form nz-form [formGroup]="searchForm" (ngSubmit)="onSearch()" nzLayout="vertical">
    <div nz-row [nzGutter]="[16, 0]">
      <div nz-col [nzXs]="24" [nzSm]="8">
        <nz-form-item>
          <nz-form-label>Tên</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="name" placeholder="Nhập tên quảng cáo" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzXs]="24" [nzSm]="8">
        <nz-form-item>
          <nz-form-label>Loại</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="type" nzPlaceHolder="Tất cả" nzAllowClear>
              @for (opt of typeOptions; track opt.value) {
                <nz-option [nzValue]="opt.value" [nzLabel]="opt.label" />
              }
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzXs]="24" [nzSm]="8">
        <nz-form-item>
          <nz-form-label>Vị trí</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="location" nzPlaceHolder="Tất cả" nzAllowClear>
              @for (opt of locationOptions; track opt.value) {
                <nz-option [nzValue]="opt.value" [nzLabel]="opt.label" />
              }
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>

  <ng-template #searchExtra>
    <div class="search-actions">
      <button nz-button nzSize="small" (click)="onReset()" type="button">
        <nz-icon nzType="redo" />
        Reset
      </button>
      <button nz-button nzType="primary" nzSize="small" (click)="onSearch()">
        <nz-icon nzType="search" />
        Tìm kiếm
      </button>
      <button nz-button nzType="primary" nzSize="small" (click)="onCreateAd()">
        <nz-icon nzType="plus" />
        Tạo mới
      </button>
    </div>
  </ng-template>
</nz-card>

<!-- Advertisements Table -->
<nz-card class="table-card">
  <app-pagination-bar
    [total]="total()"
    [pageIndex]="pageIndex()"
    [pageSize]="pageSize()"
    totalLabel="quảng cáo"
    position="top"
    (pageIndexChange)="onPageChange($event)"
    (pageSizeChange)="onPageSizeChange($event)"
  />

  <nz-table
    #adTable
    [nzData]="ads()"
    [nzLoading]="loading()"
    [nzFrontPagination]="false"
    [nzShowPagination]="false"
    [nzScroll]="{ x: '1100px' }"
    nzSize="middle"
  >
    <thead>
      <tr>
        <th nzWidth="200px">Tên</th>
        <th nzWidth="100px" nzAlign="center">Loại</th>
        <th nzWidth="150px" nzAlign="center">Vị trí hiển thị</th>
        <th nzWidth="100px" nzAlign="center">Position</th>
        <th nzWidth="80px" nzAlign="center">Thứ tự</th>
        <th nzWidth="100px" nzAlign="center">Trạng thái</th>
        <th nzWidth="150px">Ngày tạo</th>
        <th nzWidth="120px" nzAlign="center" nzRight>Hành động</th>
      </tr>
    </thead>
    <tbody>
      @for (ad of adTable.data; track ad.id) {
        <tr>
          <td>
            <span class="ad-name">{{ ad.name }}</span>
          </td>
          <td nzAlign="center">
            <nz-tag [nzColor]="ad.type === 'banner' ? 'blue' : 'purple'">
              {{ typeLabels[ad.type] || ad.type }}
            </nz-tag>
          </td>
          <td nzAlign="center">
            <nz-tag nzColor="geekblue">
              {{ locationLabels[ad.location] || ad.location }}
            </nz-tag>
          </td>
          <td nzAlign="center" class="text-muted">{{ ad.position || '—' }}</td>
          <td nzAlign="center">{{ ad.order }}</td>
          <td nzAlign="center">
            <nz-tag
              [nzColor]="ad.is_active ? 'success' : 'default'"
              class="status-tag"
              (click)="onToggleActive(ad)"
            >
              {{ ad.is_active ? 'Bật' : 'Tắt' }}
            </nz-tag>
          </td>
          <td class="text-muted">{{ ad.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
          <td nzAlign="center" nzRight>
            <div class="action-buttons">
              <button
                nz-button
                nzSize="small"
                (click)="onEditAd(ad)"
                title="Sửa"
              >
                <nz-icon nzType="edit" />
              </button>
              <button
                nz-button
                nzDanger
                nzSize="small"
                nz-popconfirm
                [nzPopconfirmTitle]="'Xóa quảng cáo \'' + ad.name + '\'?'"
                (nzOnConfirm)="onDeleteAd(ad)"
                title="Xóa"
              >
                <nz-icon nzType="delete" />
              </button>
            </div>
          </td>
        </tr>
      }
    </tbody>
  </nz-table>

  @if (ads().length > 0) {
    <app-pagination-bar
      [total]="total()"
      [pageIndex]="pageIndex()"
      [pageSize]="pageSize()"
      position="bottom"
      (pageIndexChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)"
    />
  }
</nz-card>
